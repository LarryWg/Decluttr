<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Email Assistant</title>
    <link rel="stylesheet" href="email.css">
</head>
<body>
    <div class="container">
        <!-- Header with Back button and Settings -->
        <div class="header">
            <button class="backButton" id="backBtn">← Back</button>
            <h2>Email Assistant</h2>
            <button class="settingsButton" id="settingsBtn" title="Settings">⚙️</button>
        </div>

        <!-- Settings Panel (hidden by default) -->
        <div class="settingsPanel" id="settingsPanel" style="display: none;">
            <h3>Settings</h3>
            <div class="settingItem">
                <label for="backendUrlInput">Backend URL:</label>
                <input type="text" id="backendUrlInput" value="http://localhost:3000" placeholder="http://localhost:3000" />
                <button class="saveButton" id="saveBackendUrlBtn">Save</button>
            </div>
            <div class="settingItem">
                <label>OAuth Redirect URI (for Google Cloud Console):</label>
                <div style="display: flex; gap: 5px; margin-top: 5px;">
                    <input type="text" id="redirectUriDisplay" readonly style="flex: 1; font-size: 11px; padding: 6px;" />
                    <button class="saveButton" id="copyRedirectUriBtn" style="width: auto; padding: 6px 12px;">Copy</button>
                </div>
            </div>
            <div class="settingItem">
                <button class="logoutButton" id="logoutBtn">Logout from Gmail</button>
            </div>
        </div>

        <!-- Auth Section (shown when not authenticated) -->
        <div class="authSection" id="authSection">
            <p>Connect your Gmail account to get started</p>
            <button class="button primary" id="connectGmailBtn">Connect Gmail</button>
            <p class="infoText">You'll be asked to authorize Gmail read-only access</p>
        </div>

        <!-- Loading Spinner -->
        <div class="loadingSpinner" id="loadingSpinner" style="display: none;">
            <div class="spinner"></div>
            <p>Loading emails...</p>
        </div>

        <!-- Error Message -->
        <div class="errorMessage" id="errorMessage" style="display: none;"></div>

        <!-- Success Message -->
        <div class="successMessage" id="successMessage" style="display: none;"></div>

        <!-- Email List Section -->
        <div class="emailListSection" id="emailListSection" style="display: none;">
            <div class="emailListHeader">
                <span id="accountEmail" class="accountEmail"></span>
                <button class="button small" id="refreshBtn">Refresh</button>
            </div>
            <div class="inboxTabs" id="inboxTabs">
                <button class="inboxTab active" data-inbox="primary">Primary</button>
                <button class="inboxTab" data-inbox="promotions">Promotions</button>
            </div>
            <button class="button small" id="managePromotionsBtn" style="display: none; width: 100%; margin-bottom: 12px;">Manage Promotions</button>
            <div class="emailList" id="emailList">
                <!-- Email cards will be inserted here -->
            </div>
            <button class="button small" id="loadMoreBtn" style="display: none; width: 100%; margin-top: 12px;">Load More</button>
        </div>

        <!-- Empty State -->
        <div class="emptyState" id="emptyState" style="display: none;">
            <p>No emails found</p>
        </div>
    </div>

    <!-- Unsubscribe Modal -->
    <div class="unsubscribeModal" id="unsubscribeModal" style="display: none;">
        <div class="modalContent unsubscribeModalContent">
            <p class="unsubscribeModalHint">Use Gmail&rsquo;s Unsubscribe button for reliable one-click unsubscribe.</p>
            <div class="unsubscribeModalDeleteOption">
                <label class="unsubscribeModalDeleteLabel">
                    <input type="checkbox" id="deleteEmailsCheckbox" class="unsubscribeModalDeleteCheckbox">
                    <span>Also move all emails from selected senders to trash</span>
                </label>
                <p class="unsubscribeModalDeleteHint">Emails can be recovered within 30 days.</p>
            </div>
            <div class="senderList" id="senderList">
                <!-- Sender list will be inserted here -->
            </div>
            <div class="modalActions">
                <button class="button" id="openInGmailBtn">Open in Gmail</button>
                <button class="button" id="cancelUnsubscribeBtn">Cancel</button>
                <button class="button primary" id="confirmUnsubscribeBtn">Unsubscribe &amp; optionally trash</button>
            </div>
        </div>
    </div>

    <!-- Email Detail Modal (for expanded email view) -->
    <div class="emailModal" id="emailModal" style="display: none;">
        <div class="modalContent">
            <button class="closeButton" id="closeModalBtn">×</button>
            <div class="modalHeader">
                <h3 id="modalSubject"></h3>
                <div class="modalMeta">
                    <span id="modalSender"></span>
                    <span id="modalDate"></span>
                </div>
            </div>
            <div class="modalBody">
                <div class="emailContent" id="modalBodyContent"></div>
                <div class="aiResults" id="modalAiResults">
                    <!-- AI results will be inserted here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="gmail-auth.js"></script>
    <script type="module" src="email.js"></script>
</body>
</html>
